<!doctype html>
<html>
    <head>
        <title>AR View | El Barrio Bajo El Agua</title>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
        <style>
            .close-ar { 
                position: fixed; top: 20px; left: 20px; z-index: 1000; 
                padding: 12px 20px; background: rgba(17, 33, 45, 0.8); 
                color: white; border: 1px solid #253745; border-radius: 50px; 
                text-decoration: none; font-size: 14px; font-weight: bold;
                backdrop-filter: blur(10px);
            }
            .ar-info {
                position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
                background: rgba(0,0,0,0.7); color: white; padding: 10px 20px;
                border-radius: 20px; font-family: sans-serif; font-size: 12px;
                text-align: center; pointer-events: none; z-index: 1000;
            }
        </style>
    </head>
    <body style="margin: 0; overflow: hidden;">
        <a href="index.html" class="close-ar">✕ Salir de AR</a>
        <div id="ui-info" class="ar-info">Apunta al marcador de la escena</div>

        <a-scene vr-mode-ui="enabled: false;" loading-screen="enabled: false;" renderer="logarithmicDepthBuffer: true;" arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;" id="scene" embedded gesture-detector>
            <a-assets id="assets-container">
                <a-asset-item id="asset-1" src="assets/asset1.glb"></a-asset-item>
                <a-asset-item id="asset-2" src="assets/asset2.glb"></a-asset-item>
                <a-asset-item id="asset-3" src="assets/asset3.glb"></a-asset-item>
                <a-asset-item id="asset-4" src="assets/asset4.glb"></a-asset-item>
                <a-asset-item id="asset-5" src="assets/asset5.glb"></a-asset-item>
            </a-assets>

            <a-entity id="marker-wrapper"></a-entity>

            <a-entity camera></a-entity>
        </a-scene>

        <script>
            // Lógica para detectar qué escena mostrar
            const urlParams = new URLSearchParams(window.location.search);
            const sceneId = urlParams.get('id') || '1';
            const wrapper = document.getElementById('marker-wrapper');
            const uiInfo = document.getElementById('ui-info');

            // Configuración técnica de cada marcador (escalas originales que tenías)
            const config = {
                '1': { scale: "0.02988 0.02988 0.02988", name: "Escena 1: Calle Inundada" },
                '2': { scale: "0.01840 0.01840 0.01840", name: "Escena 2: Desborde Canal" },
                '3': { scale: "0.03292 0.03292 0.03292", name: "Escena 3: Cárcamo Activo" },
                '4': { scale: "0.02611 0.02611 0.02611", name: "Escena 4: Riesgo Eléctrico" },
                '5': { scale: "0.03707 0.03707 0.03707", name: "Escena 5: Ruta de Evacuación" }
            };

            const selected = config[sceneId];
            uiInfo.innerText = `Buscando marcador de: ${selected.name}`;

            // Inyectamos SOLO el marcador solicitado
            wrapper.innerHTML = `
                <a-marker id="marker-${sceneId}" type="pattern" url="assets/marker${sceneId}.patt" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
                    <a-entity 
                        scale="${selected.scale}" 
                        animation-mixer="loop: repeat" 
                        gltf-model="#asset-${sceneId}" 
                        class="clickable" 
                        gesture-handler>
                    </a-entity>
                </a-marker>
            `;
        </script>
    </body>
</html>